#!/usr/bin/env bash
set -e

echo "[dotfiles] Setting up dotfiles..."

dir=$PWD
if [[ ! "$dir/script/install" -ef "$0" ]]; then
  echo "Please run 'script/install' from root folder"
  exit 1
fi

# Install Oh My Zsh
if [[ "$OSTYPE" != "linux-gnu"* ]]; then
    read -p "[dotfiles] Do you wish to install Oh-My-ZSH? " -n 1 -r
    echo
    if [[ $REPLY =~ ^[Yy]$ ]]; then
        /bin/bash -c "$(curl -fsSL https://raw.github.com/ohmyzsh/ohmyzsh/master/tools/install.sh)"
    fi
else
    echo "[dotfiles] Installing oh my zsh"
    sh -c "$(curl -fsSL https://raw.github.com/ohmyzsh/ohmyzsh/master/tools/install.sh)"
fi

# Symlink dotfiles

# Get a list of all files in this directory that start with a dot.
files="$(./file_list.sh)"

for dotfile in $files; do

  dotmatrix_path="$dir/$dotfile"
  path="$HOME/$dotfile"

  [ -e $dotmatrix_path ] || continue

  if [ ! -L $path ]; then
    echo "Symlinking $dotfile to $path"
    ln -nfs $dotmatrix_path $path
  else
    echo -e "Skipping $dotfile \talready exists"
  fi
done

echo "[dotfiles] Done setting up dotfiles..."
